"""
Файл с промптами для генераторов задач по математике.
Содержит промпты для Yandex API и локальной модели.
"""

#############################################################
# 1. СИСТЕМНЫЕ ПРОМПТЫ
#############################################################

# Системный промпт для Yandex API
SYSTEM_PROMPT = """Вы - опытный преподаватель математики, специализирующийся на подготовке к ЕГЭ. Вы создаете новые варианты задач, сохраняя при этом исходный уровень сложности и методы решения. 

- Ваши задачи должны быть очень похожи на примеры, но с другими числами. 
- Используйте только целые числа, простые дроби и корни из целых чисел.
- Ваши решения должны быть подробными и пошаговыми, с объяснением каждого действия.
- Задачи должны соответствовать уровню ЕГЭ по математике.
- Создавайте задачи средней или высокой сложности, соответствующие кодификатору ЕГЭ.

Давайте точные и краткие ответы без лишних пояснений. Даже, если что-то не понятно в условии, то всё равно надо дать полный ответ - дополнительных пояснений не будет."""

# Системный промпт для hint_generator.py
HINT_SYSTEM_PROMPT = "Вы - опытный преподаватель математики, специализирующийся на подготовке к ЕГЭ. Ваша задача - давать последовательные, конкретные и полезные подсказки для решения задачи, привязанные к её условию и помогающие ученику продвинуться в решении. Подсказки должны содержать конкретные элементы из задачи (числа, переменные, функции). Формулируйте подсказки точно и без лишних отступлений."

#############################################################
# 2. ГЕНЕРАЦИЯ ЗАДАЧ
#############################################################

# Промпт для генерации полного материала с YandexGPT API
def create_complete_task_prompt(category, subcategory, original_task, difficulty_level=3, add_visualization=None):
    """
    Создает промпт для генерации полного учебного материала.
    
    Args:
        category: Категория задачи
        subcategory: Подкатегория задачи
        original_task: Текст исходной задачи
        difficulty_level: Уровень подсказок (1-5, где 1 - минимальные, 5 - очень подробные)
        add_visualization: Добавлять ли визуализацию (True/False)
        
    Returns:
        str: Промпт для генерации
    """
    # Получаем инструкции для подсказок соответствующего уровня
    hint_instructions = HINT_PROMPTS.get(difficulty_level, "")
    
    # Описание уровня подсказок для промпта
    hint_descriptions = {
        1: "минимальные, указывающие только на конкретные элементы задачи без методов решения",
        2: "краткие, указывающие на конкретный метод решения с привязкой к данным задачи",
        3: "средние, с указанием ключевых формул и начальных шагов вычислений для данной задачи",
        4: "подробные, с детальными шагами решения и числовыми вычислениями",
        5: "максимально подробные, включающие пошаговое решение почти до финального ответа"
    }
    hint_description = hint_descriptions.get(difficulty_level, "средние")
    
    # Определяем, нужно ли добавлять запрос о генерации параметров для изображения
    image_prompt = ""
    
    # Проверяем, требуется ли визуализация для данной задачи
    if add_visualization is None:
        # Если параметр не задан явно, определяем автоматически
        is_visualization_required = check_visualization_requirement(category, subcategory, original_task)
    else:
        # Используем переданное значение параметра
        is_visualization_required = add_visualization
    
    if is_visualization_required:
        image_prompt = """
---ПАРАМЕТРЫ ДЛЯ ВИЗУАЛИЗАЦИИ---
ВАЖНО: Вы должны самостоятельно определить, нужна ли визуализация для данной задачи.

Внимательно проанализируйте условие задачи и определите, требуется ли визуальное представление для понимания или решения задачи.

ВОПРОСЫ ДЛЯ ОПРЕДЕЛЕНИЯ НЕОБХОДИМОСТИ ВИЗУАЛИЗАЦИИ:
1. Упоминается ли в задаче график функции, геометрическая фигура или координатная плоскость?
2. Содержит ли задача фразы "на рисунке", "на графике", "изображен", "показан"?
3. Необходимо ли визуальное представление для понимания и решения задачи?

Если вы ответили "НЕТ" на все вопросы, НЕ СОЗДАВАЙТЕ параметры для визуализации. Вместо этого напишите "Визуализация не требуется" и не добавляйте никаких параметров.

Если вы ответили "ДА" хотя бы на один вопрос, укажите параметры в следующем формате:

Тип: [график, треугольник, окружность, прямоугольник, трапеция, параллелограмм, координатная_плоскость]

Для графика функции:
Количество функций: [указать от 1 до 4]
Функция 1: [математическое выражение, например: x^2 - 3*x + 2, sin(x), sqrt(x)]
Цвет 1: [цвет для первой функции, например: синий, красный, зеленый]
Название 1: [название или обозначение для первой функции, например: f(x), y, g(x)]
Функция 2: [математическое выражение для второй функции] (если есть)
Цвет 2: [цвет для второй функции] (если есть)
Название 2: [название для второй функции] (если есть)
Функция 3: [математическое выражение для третьей функции] (если есть)
Цвет 3: [цвет для третьей функции] (если есть)
Название 3: [название для третьей функции] (если есть)
Функция 4: [математическое выражение для четвертой функции] (если есть)
Цвет 4: [цвет для четвертой функции] (если есть)
Название 4: [название для четвертой функции] (если есть)
Диапазон X: [-10, 10] или другой подходящий диапазон
Диапазон Y: [автоматический или указать конкретные значения]
Особые точки: [(x1,y1,метка1), (x2,y2,метка2), ...] - координаты особых точек, если они есть

ПРИМЕРЫ для графиков:

1. Задача с анализом графика функции с особыми точками на оси X:
Тип: график
Количество функций: 1
Функция 1: x^3 - 6*x^2 + 9*x - 4
Цвет 1: синий
Название 1: f(x)
Диапазон X: [-2, 8]
Диапазон Y: [-5, 5]
Особые точки: (-1,0,a), (1,0,b), (3,0,c), (5,0,d), (7,0,e)

2. Две функции с точками пересечения:
Тип: график
Количество функций: 2
Функция 1: x^2 - 4
Цвет 1: синий
Название 1: f(x)
Функция 2: x + 2
Цвет 2: красный
Название 2: g(x)
Диапазон X: [-5, 5]
Диапазон Y: [-5, 5]
Особые точки: (-2,0,A), (2,0,B), (-2,-4,C), (2,4,D)

Для треугольника:
Координаты: [(x1,y1), (x2,y2), (x3,y3)] - координаты вершин
Показать углы: [да/нет] - подписывать ли все значения углов
Показать стороны: [да/нет] - подписывать ли все длины сторон
Метки вершин: [A,B,C или другие метки] - какие метки использовать для вершин
Рисовать дуги углов: [да/нет] - рисовать ли дуги на углах
Показать конкретные углы: [список меток вершин, например: A,C] - подписывать только указанные углы
Показать конкретные стороны: [список сторон, например: AB,BC] - подписывать длины только указанных сторон
Показать высоты: [да/нет] - показывать ли все высоты треугольника
Показать конкретные высоты: [список меток вершин, например: A,B] - из каких вершин показать высоты
Показать медианы: [да/нет] - показывать ли все медианы треугольника
Показать конкретные медианы: [список меток вершин, например: A,C] - из каких вершин показать медианы
Показать средние линии: [да/нет] - показывать ли все средние линии треугольника
Показать конкретные средние линии: [список сторон, например: AB,BC] - какие средние линии показать

Для окружности:
Центр: [(x,y)]
Радиус: [число]
Показать радиус: [да/нет] - отображать ли линию радиуса
Показать диаметр: [да/нет] - отображать ли линию диаметра
Показать центр: [да/нет] - подписывать ли центр
Показать хорду: [да/нет] - отображать ли хорду
Значение радиуса: [число] - значение для отображения (может отличаться от фактического)
Значение диаметра: [число] - значение для отображения (может отличаться от фактического)
Значение хорды: [число] - значение для отображения

Для прямоугольника/параллелограмма/трапеции:
Размеры: [ширина, высота] - числовые значения размеров фигуры
Метки вершин: [A,B,C,D] - не больше четырех вершин, начиная с A
Показать углы: [да/нет] - подписывать ли значения углов
Длины сторон: [значение1, значение2, значение3, значение4] - точные числовые значения для длин всех сторон (если указано, длины сторон будут показаны автоматически)
Рисовать дуги углов: [да/нет] - рисовать ли дуги на углах
Показать конкретные углы: [список меток вершин, например: A,C] - подписывать только указанные углы
Показать конкретные стороны: [список сторон, например: AB,CD] - подписывать длины только указанных сторон (требуется указание размеров или длин сторон)

ВАЖНО:
1. Подписывайте ТОЛЬКО те элементы, которые действительно важны для задачи!
2. Если задача не требует знания значений углов, не указывайте "Показать углы: да".
3. Если не требуется визуализация дуг углов, укажите "Рисовать дуги углов: нет".
4. Когда нужно показать только некоторые элементы (стороны, углы, высоты и т.д.), 
   используйте параметры "Показать конкретные..." вместо общих параметров.
5. Для угла A подразумевается угол при вершине A, для стороны AB - сторона между вершинами A и B.
6. Чтобы показать длины сторон, ОБЯЗАТЕЛЬНО укажите точные числовые значения в параметрах "Размеры" и/или "Длины сторон".
7. Для геометрических фигур используйте НЕ БОЛЕЕ ЧЕТЫРЕХ вершин (для четырехугольников - только A, B, C, D).
8. Стороны фигуры будут автоматически подписаны, если указаны размеры или длины сторон.

ПРИМЕРЫ для геометрических фигур:

1. Трапеция с указанием размеров:
Тип: трапеция
Размеры: 20, 10, 5
Метки вершин: A,B,C,D
Показать конкретные стороны: AB,CD
Длины сторон: 20, 15, 10, 15

2. Прямоугольник с указанием размеров:
Тип: прямоугольник
Размеры: 8, 6
Метки вершин: A,B,C,D
Показать конкретные стороны: AB,BC

3. Неверный формат (без размеров и длин сторон):
Тип: трапеция
Размеры: [не указаны]  ← ТАК ДЕЛАТЬ НЕЛЬЗЯ!
Метки вершин: A,B,C,D,E  ← СЛИШКОМ МНОГО ВЕРШИН!

ВАЖНО:
1. Генерируйте параметры ТОЛЬКО если задача действительно требует визуального представления
2. Параметры должны точно соответствовать условию задачи
3. Если задача содержит конкретные числа, координаты, функции - используйте именно их
4. Если в задаче рассматривается несколько функций (от 1 до 4), ОБЯЗАТЕЛЬНО укажите каждую из них с соответствующими параметрами
5. НИКОГДА не пишите "Размеры: [не указаны]", всегда указывайте конкретные числовые значения
6. НИКОГДА не задавайте более 4 вершин для геометрических фигур
7. Чтобы показать длины сторон, достаточно указать размеры или длины сторон, параметр "Показать стороны" больше не требуется
"""
    
    # Основной промпт
    prompt = f"""
Вы - высококвалифицированный репетитор ЕГЭ по математике с многолетним опытом подготовки учащихся к успешной сдаче экзамена.

Создайте полный учебный материал - задачу, решение, подсказки для ЕГЭ по математике из категории "{category}" {"и подкатегории " + subcategory if subcategory else ""}.
### ПРИМЕРЫ ЗАДАЧИ В HTML или текстовом формате(МОЖЕТ ОТСУТСТВОВАТЬ) ###

---ЗАДАЧА ДЛЯ ПЕРЕРАБОТКИ---
{original_task}
---КОНЕЦ ИСХОДНЫХ ДАННЫХ---

### ТРЕБОВАНИЯ ###

МАТЕМАТИЧЕСКАЯ ТОЧНОСТЬ:
- Тщательно проверяйте все расчеты и математические формулировки
- Следите за корректностью использования математических терминов и обозначений
- Обеспечивайте однозначность условий и единственность решения (если не требуется обратное)
- Используйте стандартные математические обозначения, принятые в российском образовании

ТРЕБОВАНИЯ К ЗАДАЧАМ:
- Создавайте задачи, точно соответствующие категории и подкатегории в кодификаторе ЕГЭ
- Уровень сложности должен соответствовать формату ЕГЭ (не примитивный, но и не выходящий за рамки школьной программы российский школ)
- Предпочитайте задачи с "красивыми" числовыми ответами: целые числа, простые дроби (1/2, 3/4), 
  квадратные корни из целых чисел (√4, √9), тригонометрические значения в виде π/n
- Проверяйте условия на однозначность и отсутствие противоречий.

СТРУКТУРА РЕШЕНИЙ:
- Решение должно полностью соответствовать условию задачи
- Разбивайте решение на логические шаги с обоснованием
- Поясняйте каждое преобразование и вычисление
- Указывайте применяемые теоремы, формулы и правила
- Завершайте решение четким ответом в требуемом формате

ВАЖНО О СОХРАНЕНИИ ТИПА ЗАДАЧИ: Строго сохраняйте тип и основные элементы исходной задачи:
1. Если в исходной задаче есть модуль - новая задача ОБЯЗАТЕЛЬНО должна содержать модуль.
2. Если это логарифмическое уравнение - новая задача должна быть логарифмическим уравнением.
3. Если это задача на применение производной - сохраните этот контекст.
4. НЕ МЕНЯЙТЕ тип и ключевые элементы задачи, меняйте только числа и условия.
5. Сохраните уровень сложности и основную идею исходной задачи
6. Задача должна соответствовать уровню ЕГЭ, а не быть тривиальной
7. Создавайте задачи средней или высокой сложности, соответствующие кодификатору ЕГЭ.

Примеры правильного и неправильного сохранения типа задачи:
✓ Было: "Решите уравнение |2x - 3| = 5". Стало: "Решите уравнение |3x - 2| = 4".
✗ Было: "Решите уравнение |2x - 3| = 5". Стало: "Решите уравнение 3x - 2 = 4".
✓ Было: "Найдите наибольшее значение функции f(x) = x² + 6x + 2 на отрезке [-4; 0]". Стало: "Найдите наибольшее значение функции f(x) = x² + 4x + 3 на отрезке [-3; 1]".
✗ Было: "Найдите наибольшее значение функции". Стало: "Найдите точку экстремума функции".

Создайте новый вариант задачи, изменив числовые параметры, условия или сюжет, но сохраняя подобный уровень сложности и метод решения.

ВАЖНО О ЧИСЛАХ: Подбирайте числа так, чтобы получался "красивый" и удобный для ученика ответ:
1. Предпочтительны целые числа или простые дроби (1/2, 3/4, 2/3).
2. Избегайте громоздких выражений вида log₂(123 + √5445) + 2/5.
3. Корни лучше подбирать из квадратов целых чисел (√4, √9, √16).
4. Тригонометрические ответы по возможности выражайте через π (π/3, π/6, 3π/4).

Примеры хороших и плохих ответов:
✓ Хороший ответ: 5/2 или 2,5
✗ Плохой ответ: 103/41 или 2,512195...
✓ Хороший ответ: $\\sqrt{8} = 2 * \\sqrt{2}$
✗ Плохой ответ: $\\sqrt{38}$
✓ Хороший ответ: $\\pi/4$
✗ Плохой ответ: $0.785398...$

ВАЖНО: для форматирования используйте HTML теги вместо Markdown. Например:
- Для выделения жирным используйте <b>текст</b> вместо **текст**
- Для курсива используйте <i>текст</i> вместо *текст*
- Для переносов строк добавляйте <br> или <p>новый параграф</p>

ВАЖНО: текст решения должен быть содержательным и полным. Обязательно включите все шаги решения, не пропуская логические переходы. Без решения материал не имеет ценности.

ПРИНЦИПЫ РАЗРАБОТКИ ПОДСКАЗОК: выбран уровень подсказок {difficulty_level} - подсказки должны быть {hint_description}.
1. КОНКРЕТНОСТЬ: Каждая подсказка должна содержать специфическую информацию для конкретной задачи (числа, переменные, функции из условия)
2. ПРИРАЩЕНИЕ ИНФОРМАЦИИ: Каждая последующая подсказка должна содержать строго больше информации, чем предыдущая
3. СИСТЕМНОСТЬ: Подсказки должны формировать единую логическую цепочку, ведущую к решению
4. ИНИЦИИРОВАНИЕ МЫШЛЕНИЯ: Подсказки должны стимулировать самостоятельное мышление, а не просто давать готовые решения

ИЗБЕГАЙТЕ:
- Общих фраз без привязки к конкретным элементам задачи
- Повторения одной и той же информации в разных подсказках
- Слишком резких переходов между уровнями сложности подсказок
- Избыточного раскрытия решения на ранних уровнях подсказок

Для математических формул продолжайте использовать LaTeX между символами $ для простых формул или $$ для сложных.

Ваш ответ должен строго соответствовать следующему формату:
---ЗАДАЧА---
[Текст новой задачи]

---РЕШЕНИЕ---
[Полное пошаговое решение с пояснениями]
В конце решения обязательно запишите итоговый ответ в формате:
Ответ: [ответ] (с формулами в LaTeX)

{hint_instructions}
{image_prompt}"""

    return prompt

# Промпт для генерации новой задачи для локальной модели
def create_new_task_prompt(original_task, original_solution, category, subcategory=""):
    """
    Создает промпт для генерации новой задачи на основе оригинальной.
    
    Args:
        original_task: Текст оригинальной задачи
        original_solution: Решение оригинальной задачи
        category: Категория задачи
        subcategory: Подкатегория задачи (опционально)
        
    Returns:
        str: Промпт для генерации
    """
    return f"""
Сгенерируй новую математическую задачу из ЕГЭ по категории "{category}" 
{"и подкатегории " + subcategory if subcategory else ""}, похожую на данную:

Исходная задача: {original_task}

Исходное решение: {original_solution}

ВАЖНО: Строго сохраняй тип и основные элементы исходной задачи:
1. Если в исходной задаче есть модуль - новая задача ОБЯЗАТЕЛЬНО должна содержать модуль.
2. Если это логарифмическое уравнение - новая задача должна быть логарифмическим уравнением.
3. Если это задача на применение производной - сохрани этот контекст.
4. НЕ МЕНЯЙ тип и ключевые элементы задачи, меняй только числа и условия.

Примеры правильной замены:
✓ Было: "Решите уравнение log₃(x+2) + log₃(x-1) = 1". Стало: "Решите уравнение log₂(x+3) + log₂(x-2) = 2".
✓ Было: "Найдите площадь фигуры, ограниченной графиком функции y = x² - 4 и осью Ox". Стало: "Найдите площадь фигуры, ограниченной графиком функции y = x² - 9 и осью Ox".

ВАЖНО О ЧИСЛАХ: Подбирай числа так, чтобы получался "красивый" и удобный для ученика ответ:
1. Предпочтительны целые числа или простые дроби (1/2, 3/4, 2/3).
2. Избегай громоздких выражений вида log₂(123 + √5445) + 2/5.
3. Корни лучше подбирать из квадратов целых чисел (√4, √9, √16).
4. Тригонометрические ответы по возможности выражай через π (π/3, π/6, 3π/4).

Примеры:
✓ Хороший ответ: 7
✗ Плохой ответ: 7,42856...
✓ Хороший ответ: π/6
✗ Плохой ответ: 0,5236...

Создай новый вариант этой задачи, изменив числовые параметры, условия или сюжет, 
но сохраняя подобный уровень сложности и метод решения. 
Убедись, что задача имеет корректное решение(не допускай ответ "нет решений") и выполнима.
Математические формулы запиши в формате LaTeX между символами $$...$$

Новая задача:
"""

#############################################################
# 3. ГЕНЕРАЦИЯ РЕШЕНИЙ
#############################################################

# Промпт для генерации решения
def create_solution_prompt(task):
    """
    Создает промпт для генерации решения задачи.
    
    Args:
        task: Текст задачи
        
    Returns:
        str: Промпт для генерации
    """
    return f"""
Решите следующую математическую задачу из ЕГЭ:

{task}

ВАЖНО О РЕШЕНИИ:
1. Предоставьте полное пошаговое решение с пояснениями.
2. Разделите решение на логические этапы.
3. Объясняйте каждый шаг, особенно при применении формул и теорем.

Пример хорошего решения для задачи "Решите уравнение log₂(x+3) - log₂(x-2) = 3":
"Шаг 1: Используем свойство разности логарифмов: log₂(x+3) - log₂(x-2) = log₂((x+3)/(x-2)).
Шаг 2: Подставляем в исходное уравнение: log₂((x+3)/(x-2)) = 3.
Шаг 3: Переходим от логарифма к степени: (x+3)/(x-2) = 2³ = 8.
Шаг 4: Умножаем обе части на (x-2): x+3 = 8(x-2).
Шаг 5: Раскрываем скобки: x+3 = 8x-16.
Шаг 6: Приводим подобные: x+3-8x+16 = 0; -7x+19 = 0.
Шаг 7: Выражаем x: -7x = -19; x = 19/7 ≈ 2,71.
Шаг 8: Проверяем ОДЗ: x-2 > 0, то есть x > 2. Наше решение удовлетворяет ОДЗ."

ВАЖНО О ЧИСЛАХ: Стремитесь к красивым и понятным ответам:
1. Предпочтительны целые числа или простые дроби (1/2, 3/4, 2/3).
2. По возможности упрощайте корни (√8 → 2√2).
3. Тригонометрические ответы лучше выражать через π (π/3, π/6).
4. Логарифмы в ответах по возможности вычисляйте до целых или простых дробей.

Примеры упрощения:
✓ √12 = 2√3 (упрощено)
✗ √12 = 3,464... (не упрощено)
✓ log₂(8) = 3 (вычислено)
✗ log₂(8) (не вычислено)
✓ sin(π/6) = 1/2 (вычислено)
✗ sin(π/6) ≈ 0,5 (неточно вычислено)

Математические формулы запишите в формате LaTeX между символами $$...$$
В конце обязательно укажите итоговый ответ в наиболее упрощенной форме.

Решение:
"""

#############################################################
# 4. ГЕНЕРАЦИЯ ПОДСКАЗОК
#############################################################

# Словарь с готовыми инструкциями для подсказок разных уровней
HINT_PROMPTS = {
    0: """
---ПОДСКАЗКИ---
1. Для данного уровня подсказки не предусмотрены.
2. Для данного уровня подсказки не предусмотрены.
3. Для данного уровня подсказки не предусмотрены.
""",
    1: """
---ПОДСКАЗКИ---
[Уровень 1: Направляющие подсказки.
Первая подсказка должна обращать внимание на ключевой элемент условия задачи, но НЕ указывать метод решения. Используйте фразы вроде "Обратите внимание на...", "Важно заметить, что...", "Ключевой момент задачи...". Длина: 1-2 предложения.

Вторая подсказка должна содержать одну основную формулу или свойство, необходимое для начала решения. Упомяните ТОЛЬКО самое основное без объяснения как это применять. Длина: 1-2 предложения.

Третья подсказка должна содержать очень краткий намёк на первый шаг решения, без раскрытия всего плана. Используйте фразы вроде "Попробуйте начать с...", "Хорошей отправной точкой будет...". Длина: 1-2 предложения.]

1. Обратите внимание, что в уравнении $|3x - 5| = 7$ нужно рассмотреть два случая в зависимости от знака выражения под модулем.

2. Напомню, что модуль числа определяется как $|a| = a$ при $a \geq 0$ и $|a| = -a$ при $a < 0$.

3. Для решения сначала определите, при каких значениях $x$ выражение $3x - 5$ положительно или равно нулю, а при каких отрицательно.
""",
    2: """
---ПОДСКАЗКИ---
[Уровень 2: Вспомогательные подсказки.
Первая подсказка должна чётко сформулировать суть задачи и обратить внимание на 1-2 ключевых момента условия. Используйте доступный язык и конкретные термины из условия. Длина: 2-3 предложения.

Вторая подсказка должна содержать основные формулы или свойства для решения с минимальным пояснением их связи с задачей. Можно добавить короткую фразу о том, как они применяются, но без конкретных шагов. Длина: 2-3 предложения.

Третья подсказка должна содержать структурированный план первых двух шагов решения без подробных вычислений. Используйте числа из задачи, но оставьте самостоятельное выполнение действий ученику. Длина: 3-4 предложения.]

1. В данной задаче нужно найти все корни уравнения $\sqrt{4x+3} - \sqrt{x-1} = 2$. Обратите внимание, что выражения под корнями должны быть неотрицательными, что даёт ограничения на возможные значения $x$.

2. При решении уравнений с корнями полезно избавиться от иррациональности. Можно перенести один из корней в правую часть и возвести обе части в квадрат. Однако помните, что такое преобразование может привести к появлению посторонних корней.

3. Начните с определения области допустимых значений: $4x+3 \geq 0$ и $x-1 \geq 0$. Затем перенесите $\sqrt{x-1}$ вправо: $\sqrt{4x+3} = 2 + \sqrt{x-1}$. Возведите обе части в квадрат и преобразуйте полученное выражение.
""",
    3: """
---ПОДСКАЗКИ---
[Уровень 3: Содержательные подсказки.
Первая подсказка должна дать полное понимание условия задачи, чётко указывая на все важные ограничения и особенности. Используйте структурированное объяснение с нумерацией ключевых моментов. Длина: 3-4 предложения.

Вторая подсказка должна содержать все необходимые формулы, свойства и методы с кратким объяснением их применения к данной задаче. Можно включить простой пример или аналогию для лучшего понимания. Длина: 4-5 предложений.

Третья подсказка должна предоставлять план решения задачи с указанием основных шагов и некоторыми промежуточными результатами. Укажите 3-4 конкретных шага с частичными вычислениями, но оставьте финальные расчёты ученику. Длина: 5-6 предложений.]

1. В логарифмическом уравнении $\log_{3}(x+4) + \log_{3}(x-1) = 2$ необходимо найти все его корни. Важно помнить, что: 1) логарифмы определены только для положительных чисел, поэтому $x+4 > 0$ и $x-1 > 0$; 2) основание логарифма равно 3, а сумма логарифмов равна 2; 3) левая часть представляет собой сумму логарифмов с одинаковым основанием.

2. Для решения такого уравнения можно использовать свойство суммы логарифмов: $\log_a(m) + \log_a(n) = \log_a(m \cdot n)$. Применив это свойство, получим $\log_3((x+4)(x-1)) = 2$. Далее используем определение логарифма: если $\log_a(b) = c$, то $b = a^c$. В нашем случае это означает, что произведение $(x+4)(x-1)$ должно равняться $3^2 = 9$.

3. Решим уравнение пошагово:
   - Шаг 1: Определяем ОДЗ: $x-1 > 0$, т.е. $x > 1$.
   - Шаг 2: Применяем свойство суммы логарифмов: $\log_3((x+4)(x-1)) = 2$.
   - Шаг 3: Переходим от логарифма к степени: $(x+4)(x-1) = 3^2 = 9$.
   - Шаг 4: А далее раскрываем скобки и считаем ответ.
   Теперь вам осталось решить это квадратное уравнение и проверить корни на принадлежность ОДЗ.
""",
    4: """
---ПОДСКАЗКИ---
[Уровень 4: Подробные подсказки.
Первая подсказка должна содержать исчерпывающий анализ условия задачи с указанием всех нюансов, возможных подходов и ограничений. Разделите анализ на 3-4 логических пункта. Включите визуальный образ или аналогию, если это поможет понять задачу. Длина: 4-6 предложений.

Вторая подсказка должна предоставлять детальную теоретическую базу с объяснением всех необходимых формул и методов. Для каждого метода кратко укажите, как он применяется к данной задаче. Структурируйте информацию по пунктам. Длина: 6-8 предложений.

Третья подсказка должна содержать подробное решение задачи с большинством вычислений, но без финального ответа. Разбейте решение на этапы, для каждого приведите промежуточные вычисления. Укажите потенциальные трудности и способы их преодоления. Оставьте последнее действие или проверку ученику. Длина: 8-10 предложений.]

1. В тригонометрическом уравнении $2\sin^2 x - 3\sin x + 1 = 0$ требуется найти все решения на отрезке $[0; 2\pi]$. Разберёмся в задаче: 1) это квадратное уравнение относительно $\sin x$, а не самого $x$; 2) после нахождения значений $\sin x$ нужно будет найти соответствующие значения $x$ на указанном отрезке; 3) для каждого значения $\sin x$ может существовать несколько значений $x$ на отрезке $[0; 2\pi]$, т.к. синус – периодическая функция; 4) поскольку $|\sin x| \leq 1$, не все возможные значения переменной могут подойти.

2. Для решения этого уравнения применим следующие теоретические положения:
   - Метод замены переменной: если обозначить $\sin x = t$, то уравнение примет вид $2t^2 - 3t + 1 = 0$.
   - Формула дискриминанта квадратного уравнения: $D = b^2 - 4ac$, где $a=2$, $b=-3$, $c=1$.
   - Формула корней квадратного уравнения: $t = \frac{-b \pm \sqrt{D}}{2a}$.
   - Формулы для нахождения всех значений $x$ на отрезке $[0; 2\pi]$, при которых $\sin x = t$:
     * Если $t \in [-1, 1]$, то $x = \arcsin t + 2\pi n$ или $x = \pi - \arcsin t + 2\pi n$, где $n$ - целое число.
     * Для отрезка $[0; 2\pi]$ значение $n$ может быть только 0.

3. Решим уравнение $2\sin^2 x - 3\sin x + 1 = 0$ на отрезке $[0; 2\pi]$:
   - Шаг 1: Сделаем замену $\sin x = t$ и решим квадратное уравнение $2t^2 - 3t + 1 = 0$.
     Находим дискриминант: $D = (-3)^2 - 4 \cdot 2 \cdot 1 = 9 - 8 = 1$.
     Корни: $t_1 = \frac{3 + 1}{4} = 1$ и $t_2 = \frac{3 - 1}{4} = \frac{1}{2}$.
   - Шаг 2: Проверяем, что $t_1 = 1$ и $t_2 = \frac{1}{2}$ удовлетворяют условию $|t| \leq 1$.
   - Шаг 3: Находим все значения $x$ на отрезке $[0; 2\pi]$, при которых $\sin x = 1$:
     При $\sin x = 1$ получаем $x = \frac{\pi}{2} + 2\pi n$. На отрезке $[0; 2\pi]$ это только $x = \frac{\pi}{2}$.
   - Шаг 4: Находим все значения $x$ на отрезке $[0; 2\pi]$, при которых $\sin x = \frac{1}{2}$:
     При $\sin x = \frac{1}{2}$ получаем $x = \frac{\pi}{6} + 2\pi n$ или $x = \pi - \frac{\pi}{6} + 2\pi n = \frac{5\pi}{6} + 2\pi n$.
     На отрезке $[0; 2\pi]$ это $x = \frac{\pi}{6}$, $x = \frac{5\pi}{6}$, $x = \frac{\pi}{6} + 2\pi = \frac{13\pi}{6}$ и $x = \frac{5\pi}{6} + 2\pi = \frac{17\pi}{6}$.
   
   Теперь нужно определить, какие из этих значений действительно являются корнями исходного уравнения. Подставьте их в исходное уравнение для проверки.
""",
    5: """
---ПОДСКАЗКИ---
[Уровень 5: Детальный разбор.
Первая подсказка должна представлять всесторонний анализ задачи, включающий все возможные интерпретации, нюансы и особенности. Разбейте анализ на 4-5 чётких пунктов с пояснениями. Включите наглядный пример или аналогию для лучшего понимания. Длина: 6-8 предложений.

Вторая подсказка должна содержать исчерпывающую теоретическую базу с объяснением всех формул, их происхождения и применимости к задаче. Для каждого метода дайте чёткое пояснение как и почему он работает. Структурируйте материал по параграфам с нумерацией ключевых положений. Длина: 8-10 предложений.

Третья подсказка должна представлять собой практически полное решение с подробными пошаговыми вычислениями, анализом всех вариантов и проверкой результатов. Разбейте решение на пронумерованные этапы с промежуточными результатами и пояснениями. Оставьте лишь минимальную работу ученику (финальное округление, подстановку или запись ответа). Включите проверку полученного результата. Длина: 10-12 предложений.]

1. В задаче по теории вероятностей требуется найти вероятность того, что при 5 бросках монеты выпадет ровно 3 орла. Проанализируем условие задачи: 1) мы имеем дело с последовательностью испытаний Бернулли (бросок монеты), где каждое испытание имеет два исхода – орёл или решка; 2) испытания являются независимыми, т.е. результат одного броска не влияет на результаты других; 3) вероятность выпадения орла в каждом испытании равна 0,5, т.е. p = 0,5; 4) нас интересует конкретное количество успехов – ровно 3 орла из 5 бросков; 5) эта задача похожа на ситуацию, когда мы считаем вероятность получить определённое количество правильных ответов при случайном выборе вариантов в тесте.

2. Для решения этой задачи применяются следующие теоретические положения:
   
   1) Схема испытаний Бернулли: серия независимых испытаний с двумя возможными исходами (успех/неудача), где вероятность успеха p постоянна.
   
   2) Формула Бернулли для вероятности ровно k успехов в n испытаниях: 
      P(k) = C(n,k) * p^k * (1-p)^(n-k), где:
      - C(n,k) – число сочетаний из n по k, показывающее количество способов выбрать k позиций из n;
      - p^k – вероятность успеха в выбранных k испытаниях;
      - (1-p)^(n-k) – вероятность неудачи в оставшихся (n-k) испытаниях.
   
   3) Формула для вычисления числа сочетаний: 
      C(n,k) = n!/(k!*(n-k)!), где n! – факториал числа n (произведение всех целых чисел от 1 до n).
   
   4) В нашем случае: n = 5 (всего бросков), k = 3 (желаемое число орлов), p = 0,5 (вероятность выпадения орла).

3. Найдём вероятность выпадения ровно 3 орлов при 5 бросках монеты:

   Шаг 1: Вычислим число сочетаний C(5,3):
   C(5,3) = 5!/(3!*2!) = (5*4*3*2*1)/((3*2*1)*(2*1)) = 120/(6*2) = 120/12 = 10.
   
   Шаг 2: Подставим все значения в формулу Бернулли:
   P(3) = C(5,3) * p^3 * (1-p)^(5-3) = 10 * (0,5)^3 * (0,5)^2.
   
   Шаг 3: Вычислим вероятность:
   P(3) = 10 * (0,5)^3 * (0,5)^2 = 10 * (0,5)^5 = 10 * (1/32) = 10/32 = 5/16 = 0,3125.
   
   Шаг 4: Проверим результат другим методом. Мы можем использовать свойство биномиального распределения, согласно которому вероятность количества успехов симметрична относительно среднего значения np = 5*0,5 = 2,5 при p = 0,5. Это означает, что P(3) = P(2) для p = 0,5. Действительно, C(5,2) = 10, и P(2) = 10 * (0,5)^2 * (0,5)^3 = 10 * (0,5)^5 = 10/32 = 5/16 = 0,3125.
   
   Таким образом, вероятность выпадения ровно 3 орлов при 5 бросках монеты равна 5/16 или 0,3125 (31,25%).
"""
}

# Промпт для генерации подсказок
def create_hints_prompt(task, solution, difficulty_level=3):
    """
    Создает промпт для генерации подсказок.
    
    Args:
        task: Текст задачи
        solution: Полное решение задачи
        difficulty_level: Уровень сложности подсказок (1-5)
        
    Returns:
        str: Промпт для генерации
    """
    # Преобразуем уровень сложности в описание для промпта
    hint_description = {
        1: "минимальные подсказки, но всё равно относящиеся к конкретной задаче",
        2: "краткие подсказки с указанием конкретного метода для этой задачи",
        3: "подробные подсказки среднего уровня с указанием формул и начальных шагов конкретно для этой задачи (3-5 предложений)",
        4: "развернутые подсказки с конкретными вычислениями и значениями из задачи (4-6 предложений)",
        5: "максимально подробное пошаговое решение из нескольких абзацев, практически полностью раскрывающее ответ"
    }.get(difficulty_level, "средние подсказки")

    return f"""
Создайте 3 последовательные подсказки для решения конкретной математической задачи ЕГЭ:

Задача: {task}

Полное решение: {solution}

Уровень подсказок: {difficulty_level} (по шкале от 1 до 5)

ВАЖНО: Избегайте общих рекомендаций! Используйте КОНКРЕТНЫЕ элементы из задачи (числа, переменные, функции). 
НЕ ДАВАЙТЕ подсказки вида "подумайте о применении теоремы Виета" или "используйте метод интервалов" - вместо этого привязывайте подсказки к конкретным данным задачи!

Требуется создать {hint_description}.
Чем выше число (от 1 до 5), тем более подробными должны быть подсказки:
- Уровень 1: минимальные подсказки, но с упоминанием конкретных значений из задачи
  Пример: "Обратите внимание, что коэффиценты *числителя слева* и *знаменателя справа* совпадают в уравнении" вместо "Посмотрите на коэффициенты в уравнении"
- Уровень 3: подробные подсказки из 3-5 предложений с конкретными шагами
- Уровень 5: почти полное решение с конкретными вычислениями, разбитое на несколько абзацев

ВАЖНО О КОЛИЧЕСТВЕ ТЕКСТА:
- Для уровней 1-2: короткие подсказки из 1-2 предложений 
- Для уровней 3-4: развернутые подсказки из 3-6 предложений
- Для уровня 5: полноценные абзацы с подробными объяснениями и вычислениями

Примеры ХОРОШИХ подсказок для задачи "$x^2 - 5x + 6 = 0$":
- Уровень 1: "Обратите внимание, что коэффициенты уравнения $x^2 - 5x + 6 = 0$ позволяют разложить левую часть на множители" (конкретная задача и намек)
- Уровень 3: "Для уравнения $x^2 - 5x + 6 = 0$ найдите корни. Используя теорему Виета, получаем, что их сумма равна 5, а произведение равно 6. Эти корни можно подобрать, перебирая числа, произведение которых равно 6, а сумма равна 5. Попробуйте числа 2 и 3, их произведение $2 \cdot 3 = 6$, а сумма $2 + 3 = 5$." (формулы и начальные шаги с детальным объяснением)
- Уровень 5: "Шаг 1: Разложим квадратный трехчлен $x^2 - 5x + 6$ на множители. Найдем числа, сумма которых равна -5, а произведение равно 6. Это числа -2 и -3. 
  
  Шаг 2: Запишем разложение трехчлена: $x^2 - 5x + 6 = (x - 2)(x - 3) = 0$. 
  
  Шаг 3: Отсюда получаем систему $x - 2 = 0$ или $x - 3 = 0$, значит $x = 2$ или $x = 3$. Проверим оба корня подстановкой в исходное уравнение..." (детальные шаги с разбивкой на абзацы)

Подсказки должны создавать последовательную цепочку, раскрывая ход решения:
1. Первая подсказка: выделение ключевых элементов условия задачи, чтобы любой школьник мог правильно понять условие задачи, а также начальное наблюдение или первый шаг, привязанный к конкретным элементам задачи
2. Вторая подсказка: существенное продвижение в решении с формулами и конкретными значениями
3. Третья подсказка: предпоследний шаг решения, оставляющий ученику минимальную работу

Подсказки (разделенные ###):
"""

def check_visualization_requirement(category, subcategory, task_text):
    """
    Определяет, требуется ли визуализация для задачи на основе категории и подкатегории.
    
    Args:
        category: Категория задачи
        subcategory: Подкатегория задачи
        task_text: Текст задачи
        
    Returns:
        bool: True, если требуется визуализация, False в противном случае
    """
    # Категории и подкатегории, требующие визуализации
    visualization_categories = {
        # Базовый уровень
        "Анализ графиков и диаграмм": True,
        "Задачи на квадратной решетке": True,
        "Задачи по стереометрии": True,
        "Планиметрия": True,
        "Прикладная геометрия": True,
        "Прикладная стереометрия": True,
        "Производная и первообразная": True,
        "Стереометрия": True,
        "Чтение графиков и диаграмм": True,
        
        # Профильный уровень
        "Векторы": True,
        "Графики функций": True,
        "Задача с параметром": True,
        "Квадратная решётка, координатная плоскость": True,
        "Многоконфигурационная планиметрическая задача": True,
        "Планиметрическая задача": True,
        "Планиметрия: вычисление длин и площадей": True,
        "Сложная планиметрия": True,
        "Сложная стереометрия": True,
        "Стереометрическая задача": True,
    }
    
    # Подкатегории, требующие визуализации
    visualization_subcategories = {
        # Подкатегории, связанные с графиками
        "Анализ графиков функций": True,
        "Корни": True,
        "Параболы": True,
        "Гиперболы": True,
        "Показательные и логарифмические функции": True,
        "Тригонометрические функции": True,
        "Линейные функции": True,
        "Кусочно-линейная функция": True,
        "Функции, зависящие от параметра": True,
        "Уравнение окружности": True,
        "Координаты (x, a)": True,
        
        # Подкатегории, связанные с геометрией
        "Треугольники и их элементы": True,
        "Четырёхугольники и их элементы": True,
        "Многоугольники": True,
        "Окружность": True,
        "Трапеция": True,
        "Треугольник": True,
        "Ромб": True,
        "Произвольный четырехугольник": True,
        "Многоугольники: вычисление длин и углов": True,
        "Координатная плоскость": True,
        "Круг и его элементы": True,
        "Многоугольники: вычисление площадей": True,
        "Окружности и треугольники": True,
        "Окружности и системы окружностей": True,
        "Окружности и четырёхугольники": True,
        "Многоугольники и их свойства": True,
        "Треугольники общего вида": True,
        "Задачи, связанные с углами": True,
        "Решение равнобедренного треугольника": True,
        "Параллелограммы": True,
        "Описанные окружности": True,
        "Решение прямоугольного треугольника": True,
        "Вписанные окружности": True,
        "Центральные и вписанные углы": True,
        "Касательная, хорда, секущая": True,
        
        # Подкатегории, связанные со стереометрией
        "Параллелепипед": True,
        "Призма": True,
        "Пирамида": True,
        "Цилиндр": True,
        "Конус": True,
        "Шар": True,
        "Многогранники: ребра, грани": True,
        "Куб": True,
        "Прямоугольный параллелепипед": True,
        "Площадь поверхности составного многогранника": True,
        "Объем составного многогранника": True,
        "Круглые тела": True,
        "Многогранники": True,
        "Угол между прямой и плоскостью": True,
        "Угол между плоскостями": True,
        "Комбинации фигур": True,
        "Круглые тела: цилиндр, конус, шар": True,
        "Расстояние между прямыми и плоскостями": True,
        "Сечения круглых тел": True,
        "Угол между скрещивающимися прямыми": True,
        "Угол между плоскостями граней многогранника": True,
        "Объёмы многогранников": True,
        "Расстояние от точки до плоскости": True,
        "Сечения параллелепипедов": True,
        "Сечения призм": True,
        "Расстояние от точки до прямой": True,
        "Сечения пирамид": True,
        "Комбинации тел": True,
        "Элементы составных многогранников": True,
        
        # Подкатегории, связанные с производной и первообразной
        "Физический смысл производной": True,
        "Геометрический смысл производной, касательная": True,
        "Применение производной к исследованию функций": True,
        "Первообразная": True,
    }
    
    # Проверяем, требуется ли визуализация для данной категории или подкатегории
    if category in visualization_categories:
        return True
    
    if subcategory in visualization_subcategories:
        return True
    
    # Проверяем ключевые слова в тексте задачи, если категория и подкатегория не определены
    visualization_keywords = [
        "график", "функц", "координат", "плоскост", "точк", "треугольник", 
        "окружност", "круг", "прямоугольник", "трапеци", "параллелограмм", 
        "ромб", "квадрат", "куб", "призм", "пирамид", "цилиндр", "конус", 
        "шар", "сфер", "параллелепипед", "многогранник", "касательн", 
        "хорд", "секущ", "высот", "медиан", "биссектрис", "равнобедренн", 
        "равносторонн", "прямоугольн", "ось абсцисс", "ось ординат", 
        "парабол", "гипербол", "синусоид", "косинусоид", "тангенсоид", 
        "экспонент", "логарифм", "производн", "интеграл", "первообразн"
    ]
    
    # Проверяем наличие ключевых слов в тексте задачи
    for keyword in visualization_keywords:
        if keyword.lower() in task_text.lower():
            return True
    
    return False

#############################################################
# 5. ВИЗУАЛИЗАЦИЯ И ДРУГИЕ ФУНКЦИИ
#############################################################

# Промпт для визуализации геометрических фигур и графиков
VISUALIZATION_FORMATS = {
    "triangle": {
        "description": "Треугольник с настраиваемыми параметрами.",
        "parameters": {
            "points": "Координаты вершин в формате [(x1,y1), (x2,y2), (x3,y3)]",
            "vertex_labels": "Метки вершин, например ['A', 'B', 'C']",
            "show_labels": "Показывать ли метки вершин (True/False)",
            "show_angles": "Показывать ли углы (True/False)",
            "is_right": "Является ли треугольник прямоугольным (True/False)",
            "side_lengths": "Длины сторон для отображения [сторона1, сторона2, сторона3] или None для сторон, которые не нужно отображать"
        }
    },
    "rectangle": {
        "description": "Прямоугольник с настраиваемыми параметрами.",
        "parameters": {
            "x": "Координата x левого нижнего угла",
            "y": "Координата y левого нижнего угла",
            "width": "Ширина прямоугольника",
            "height": "Высота прямоугольника",
            "vertex_labels": "Метки вершин, например ['A', 'B', 'C', 'D']",
            "show_labels": "Показывать ли метки вершин (True/False)",
            "show_lengths": "Показывать ли длины сторон (True/False)",
            "show_angles": "Показывать ли углы (True/False)",
            "side_lengths": "Длины сторон для отображения [сторона1, сторона2, сторона3, сторона4] или None для сторон, которые не нужно отображать"
        }
    },
    "parallelogram": {
        "description": "Параллелограмм с настраиваемыми параметрами.",
        "parameters": {
            "x": "Координата x левого нижнего угла",
            "y": "Координата y левого нижнего угла",
            "width": "Ширина параллелограмма (нижнее основание)",
            "height": "Высота параллелограмма",
            "skew": "Угол наклона в градусах",
            "vertex_labels": "Метки вершин, например ['A', 'B', 'C', 'D']",
            "show_labels": "Показывать ли метки вершин (True/False)",
            "show_lengths": "Показывать ли длины сторон (True/False)",
            "show_angles": "Показывать ли углы (True/False)",
            "side_lengths": "Длины сторон для отображения [сторона1, сторона2, сторона3, сторона4] или None для сторон, которые не нужно отображать"
        }
    },
    "trapezoid": {
        "description": "Трапеция с настраиваемыми параметрами.",
        "parameters": {
            "x": "Координата x левого нижнего угла",
            "y": "Координата y левого нижнего угла",
            "bottom_width": "Ширина нижнего основания",
            "top_width": "Ширина верхнего основания",
            "height": "Высота трапеции",
            "vertex_labels": "Метки вершин, например ['A', 'B', 'C', 'D']",
            "show_labels": "Показывать ли метки вершин (True/False)",
            "show_lengths": "Показывать ли длины сторон (True/False)",
            "show_angles": "Показывать ли углы (True/False)",
            "side_lengths": "Длины сторон для отображения [сторона1, сторона2, сторона3, сторона4] или None для сторон, которые не нужно отображать"
        }
    },
    "circle": {
        "description": "Окружность с настраиваемыми параметрами.",
        "parameters": {
            "center": "Координаты центра окружности в формате (x, y)",
            "radius": "Радиус окружности",
            "center_label": "Метка центра, например 'O'",
            "show_center": "Показывать ли центр (True/False)",
            "show_radius": "Показывать ли радиус (True/False)",
            "show_diameter": "Показывать ли диаметр (True/False)",
            "show_chord": "Показывать ли хорду (True/False)",
            "radius_value": "Значение радиуса для отображения (может отличаться от фактического)",
            "diameter_value": "Значение диаметра для отображения (может отличаться от фактического)",
            "chord_value": "Значение хорды для отображения"
        }
    }
}

# Параметры по умолчанию для фигур
DEFAULT_VISUALIZATION_PARAMS = {
    "triangle": {
        "points": [(0,0), (4,0), (2,3)],
        "show_labels": True,
        "vertex_labels": ["A", "B", "C"],
        "show_angles": False,
        "is_right": False
    },
    "rectangle": {
        "x": 0,
        "y": 0,
        "width": 4,
        "height": 3,
        "show_labels": True,
        "vertex_labels": ["A", "B", "C", "D"],
        "show_lengths": False,
        "show_angles": False
    },
    "parallelogram": {
        "x": 0,
        "y": 0,
        "width": 4,
        "height": 3,
        "skew": 60,
        "show_labels": True,
        "vertex_labels": ["A", "B", "C", "D"],
        "show_lengths": False,
        "show_angles": False
    },
    "trapezoid": {
        "x": 0,
        "y": 0,
        "bottom_width": 6,
        "top_width": 3,
        "height": 3,
        "show_labels": True,
        "vertex_labels": ["A", "B", "C", "D"],
        "show_lengths": False,
        "show_angles": False,
        "side_lengths": [6, 3.6, 3, 3.6]  # [нижнее_основание, правая_боковая, верхнее_основание, левая_боковая]
    },
    "circle": {
        "center": (0, 0),
        "radius": 3,
        "center_label": "O",
        "show_center": True,
        "show_radius": False,
        "show_diameter": False
    }
}

# Шаблоны регулярных выражений для извлечения параметров из текста
REGEX_PATTERNS = {
    "generic": {
        "type": r'Тип изображения[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "shape_type": r'Тип[^:]*:\s*["\']?([^"\'\n]+)["\']?', 
    },
    "triangle": {
        "coords": r'Координаты вершин[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "angles": r'Показать углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "lengths": r'Показать стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "vertex_labels": r'Метки вершин[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "is_right": r'Прямоугольный[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "side_lengths": r'Длины сторон[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "angle_values": r'Значения углов[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_angle_arcs": r'Рисовать дуги углов[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_angles": r'Показать конкретные углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_sides": r'Показать конкретные стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_heights": r'Показать высоты[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_heights": r'Показать конкретные высоты[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_medians": r'Показать медианы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_medians": r'Показать конкретные медианы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_midlines": r'Показать средние линии[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_midlines": r'Показать конкретные средние линии[^:]*:\s*["\']?([^"\'\n]+)["\']?'
    },
    "rectangle": {
        "dimensions": r'Размеры[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "coords": r'Координаты[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "vertex_labels": r'Метки вершин[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_dimensions": r'Показать размеры[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_labels": r'Показать метки[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "side_lengths": r'Длины сторон[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_angles": r'Показать углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "angle_values": r'Значения углов[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_angle_arcs": r'Рисовать дуги углов[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_angles": r'Показать конкретные углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_sides": r'Показать конкретные стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_lengths": r'Показать стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_specific_angles": r'Показать конкретные углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_specific_sides": r'Показать конкретные стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?'
    },
    "parallelogram": {
        "dimensions": r'Размеры[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "coords": r'Координаты[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "vertex_labels": r'Метки вершин[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_dimensions": r'Показать размеры[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_labels": r'Показать метки[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "skew_angle": r'Наклон[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "side_lengths": r'Длины сторон[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_angles": r'Показать углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "angle_values": r'Значения углов[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_angle_arcs": r'Рисовать дуги углов[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_angles": r'Показать конкретные углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_sides": r'Показать конкретные стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_lengths": r'Показать стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_specific_angles": r'Показать конкретные углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_specific_sides": r'Показать конкретные стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?'
    },
    "trapezoid": {
        "dimensions": r'Размеры[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "coords": r'Координаты[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "vertex_labels": r'Метки вершин[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_dimensions": r'Показать размеры[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_labels": r'Показать метки[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "top_width": r'Верхняя база[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "side_lengths": r'Длины сторон[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_angles": r'Показать углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "angle_values": r'Значения углов[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_angle_arcs": r'Рисовать дуги углов[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_angles": r'Показать конкретные углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "specific_sides": r'Показать конкретные стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_lengths": r'Показать стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_specific_angles": r'Показать конкретные углы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
        "show_specific_sides": r'Показать конкретные стороны[^:]*:\s*["\']?([^"\'\n]+)["\']?'
    },
    "circle": {
            "center": r'Центр[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "radius": r'Радиус[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "center_label": r'Метка центра[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "show_radius": r'Показать радиус[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "show_diameter": r'Показать диаметр[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "show_chord": r'Показать хорду[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "radius_value": r'Значение радиуса[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "diameter_value": r'Значение диаметра[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "chord_value": r'Значение хорды[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "show_specific_angles": r'Показать\s+конкретные\s+углы[:\s]+([^\n]+)',
            "show_specific_sides": r'Показать\s+конкретные\s+стороны[:\s]+([^\n]+)'
        },
        "graph": {
            "function": r'Функция[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "x_range": r'Диапазон X[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "y_range": r'Диапазон Y[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "functions": r'Функции[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "num_functions": r'Количество функций[^:]*:\s*["\']?(\d+)["\']?',
            "function_1": r'Функция 1[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "function_2": r'Функция 2[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "function_3": r'Функция 3[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "function_4": r'Функция 4[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "color_1": r'Цвет 1[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "color_2": r'Цвет 2[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "color_3": r'Цвет 3[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "color_4": r'Цвет 4[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "name_1": r'Название 1[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "name_2": r'Название 2[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "name_3": r'Название 3[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "name_4": r'Название 4[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "special_points": r'Особые точки[^:]*:\s*["\']?([^"\'\n]+)["\']?'
        },
        "coordinate": {
            "points": r'Точки[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "vectors": r'Векторы[^:]*:\s*["\']?([^"\'\n]+)["\']?',
            "functions": r'Функции[^:]*:\s*["\']?([^"\'\n]+)["\']?'
        }
}   